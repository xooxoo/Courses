---
title: "**АНАЛИЗ МОРФОМЕТРИЧЕСКИХ ХАРАКТЕРИСТИК ОБЛОМКОВ ПОРОД В РАЙОНЕ ДЕРЕВНИ САТИНО**"
author: "***ШИШКИН В.С.***"
output:
  html_document:
    toc: yes
    toc_float: yes
    css: style.css
---

```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(data.table)
library(ggvis)
library(kableExtra)
library(scales)

options(scipen = 0, digits = 3)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

## **ВВЕДЕНИЕ**
```{r import, cache=TRUE}
rocks <- fread("satino_rocks.csv", header = T, sep = ";", dec = ",",
               stringsAsFactors = T)
rocks <- rocks %>% separate(Link, c("Observer", "Year"), ", ")

levels(rocks$Place) <- c("Волчий овраг", "Егоров овраг", 
                         "Излучина реки Протвы", "Обцарский овраг", 
                         "Пойма реки Протвы", "Рыжковское кладбище", 
                         "Ручей Язвицы")

rocks$Place <- factor(rocks$Place, levels(rocks$Place)[c(3, 5, 6, 7, 1, 2, 4)])

avtohton <- c("габбро", "гранит", "гранит-пегматит", "гранито-гнейс",
              "гранито-диорит", "диабаз", "основная гп", "шокс. кварцит",
              "шокш. кварцит")

rocks$P_location <- as.factor(sapply(rocks$P, function(x) ifelse(is.element(x,avtohton), "AV", "AL")))

rocks$KI <- (rocks$A + rocks$B) / (2 * rocks$C)
rocks$KL <- 1 - rocks$B/rocks$A
rocks$KH <- 1 - rocks$C/rocks$B
```

В работе рассматриваются результаты анализа морфометрии обломков, полученных из разрезов рыхлых отложений в пределах бассейна реки Протвы, в районе деревни Сатино Калужской области[^1].  

[^1]: Расположение деревни Сатино на [Яндекс.Картах](https://yandex.ru/maps/?clid=1985551-225&ll=36.380161%2C55.206673&z=15)

Одной из главных целей изучения рыхлых отложений является определение их происхождения. В качестве одного из вспомогательных методов определения используется морфометрический анализ содержащихся в них обломков, который позволяет разделить отложения в зависимости от динамических условий их формирования.


## **1. МЕТОДИКА**
Форма обломка включает в себя соотношение размеров по трем основным осям обломка (длина, ширина и толщина), а также степень его окатанности. Первоначальная форма обусловлена петрографическим составом пород, который определяет прочность обломка, а также позволяет установить родительскую провинцию породы. Последнее дает представление о месте образования первоначального обломка и, как следствие, о дальности и длительности переноса каким-либо рельефообразующим агентом (водным потоком, воздушным потоком, ледником и др.). Таким образом, форма обломка зависит от петрографического состава породы и от динамической обстановки, в которой этот обломок формировался.  

В качестве одной из численных характеристик формы обломков используется **коэффициент изометричности** KI [1]:  
$$KI = \frac{A + B}{2C}$$
*где, A - длина обломка, B - ширина обломка, C - толщина обломка (A > B > C)*  

Кроме показателя изометричности используются показатели **удлиненности** KL и **уплощенности** KH обломка [2], рассчитывающиеся по формуле:  
$$KL = 1 - \frac{B}{A}$$
$$KH = 1 - \frac{C}{B}$$

Для обработки и анализа данных использовался язык программирования *R (версия `r getRversion()`)* и среда разработки *R Studio*.  

## **2. РЕЗУЛЬТАТЫ**
### ***2.1. Подготовка данных***
Всего было отобрано `r nrow(rocks)` образцов из `r nlevels(rocks$Place)` разрезов за период `r min(rocks$Year)`-`r max(rocks$Year)` гг. Три разреза расположены в пределах долины Протвы, на поверхности высокой поймы ("Излучина реки Протвы", "Пойма реки Протвы") и низкой надпойменной террасы ("Рыжковское кладбище"), один разрез сделан в днище долины притока Протвы ("Ручей Язвицы") и три разреза представляют собой расчистки бортов долин временных водотоков ("Волчий овраг", "Егоров овраг", "Обцарский овраг"), спускающихся в долину Протвы. Таким образом, можно выделить отложения двух динамических обстановок:

1. отложения постоянных водотоков (аллювиальные отложения) - река Протва, ручей Язвицы

2. отложения временных водотоков (пролювиальные отложения) - Волчий овраг, Егоров овраг, Обцарский овраг

Следует ожидать, что морфометрические показатели обломков для этих типов отложений из соответствующих разрезов должны различаться между собой.  

В таблице 1 приведены основные морфометрические показатели обломков из исследуемых разрезов.  

```{r table, comment="", dependson="import"}
table_1 <- rocks %>%
  group_by("Разрез" = Place) %>%
  summarize(N = n(),
            AL = sum(P_location == "AL"),
            AV = sum(P_location == "AV"),
            A = mean(A),
            B = mean(B),
            C = mean(C),
            KI = mean(KI),
            KL = mean(KL),
            KH = mean(KH))

kable(data.frame(table_1), align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "bordered")) %>%
  add_header_above(c("Таблица 1. Основные морфометрические характеристики обломков" = ncol(table_1))) %>% 
  column_spec(1, italic = T) %>%
  footnote(number = c("N - количество обломков; ", 
                      "AL - количество местных обломков; ", 
                      "AV - количество принесенных обломков"))
```

### ***2.2. Дисперсионный анализ***
Для поиска различий в морфометрических характеристиках обломков из исследуемых разрезов применялся дисперсионный анализ. Нулевая гипотеза состоит в том, что эти отложения не различаются между собой, то есть их математические ожидания равны. Уровень значимости принимался за 0.05. В таблице 2 приведены результаты дисперсионного анализа для морфометрических коэффициентов обломков в зависимости от места отбора обломков:

```{r aov table, comment="", dependson="import"}
aov_table <- function(dep_var, title_name){
  tmp_table <- as.data.table(unclass(summary(aov(
    as.formula(paste(dep_var, "~", "Place")), rocks))), 
    check.names = FALSE, stringsAsFactors = FALSE)
  
  tmp_table[is.na(tmp_table)] <- "-"
  tmp_table[1, 4] <- round(as.numeric(tmp_table[1, 4]), digits = 2)
  tmp_table[1, 5] <- scientific_format()(as.numeric(tmp_table[1, 5]))
  tmp_table <- cbind(rep(title_name, times = 2), tmp_table)
  
  colnames(tmp_table) <- c("Коэффициент", "Число степеней свободы", 
                           "Сумма квадратов", "Средний квадрат", 
                           "F-значение", "Уровень значимости")
  return(tmp_table)
}

result_aov_table <-  rbind(aov_table("KI", "Изометричности KI"),
                           aov_table("KL", "Удлиненности KL"),
                           aov_table("KH", "Уплощенности KH"))

kable(result_aov_table, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "bordered")) %>%
  add_header_above(c("Таблица 2. Результаты дисперсионного анализа для морфометрических коэффициентов" = ncol(result_aov_table))) %>%
  column_spec(1, bold = T) %>%
  collapse_rows(columns = 1, valign = "middle")
```

По результатам дисперсионного анализа удалось выявить статистически значимую взаимосвязь места отбора обломков с коэффициентом изометричности KI (F(6, 928) = 11.57, p < 0,05), коэффициентом удлиненности KL (F(6, 928) = 10.41, p < 0,05) и коэффициентом уплощенности KH (F(6, 928) = 3.04, p < 0,05). В таблице 3 представлены попарные сравнения отложений, рассчитанные с учетом поправки Тьюки на множественные сравнения, для которых уровень значимости больше 0.05.

```{r TukeyHSD, dependson="import"}
Tukey_table <- function(dep_var){
  Tukey_tmp <- TukeyHSD(aov( as.formula(paste(dep_var, "~", "Place")), rocks))
  Tukey_table_tmp <- as.data.table(
    Tukey_tmp$Place[, 4][Tukey_tmp$Place[, 4] < 0.05],
    row.names(names(Tukey_tmp$Place[, 4][Tukey_tmp$Place[, 4] < 0.05])))
  Tukey_table_tmp[, 2] <- sapply(Tukey_table_tmp[, 2], 
                             function(x) scientific_format()(as.numeric(x)))
  return(Tukey_table_tmp)
}

Tukey_KI <- Tukey_table("KI")
Tukey_KL <- Tukey_table("KL")
Tukey_KH <- Tukey_table("KH")

result_Tukey_table <-  rbind(Tukey_KI, Tukey_KL, Tukey_KH)
colnames(result_Tukey_table) <- c('', 'Уровень значимости')

kable(result_Tukey_table, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "bordered")) %>%
  add_header_above(c("Таблица 3. Попарные сравнения мест отбора обломков, рассчитанные с учетом поправки Тьюки, с уровнем значимости меньше 0.05" = ncol(result_Tukey_table))) %>%
  group_rows(index = c("Коэффициент изометричности" = nrow(Tukey_KI), 
                       "Kоэффициент удлиненности" = nrow(Tukey_KL), 
                       "Коэффициент уплощенности" = nrow(Tukey_KH)))
```

Как видно из таблицы 3 статистически значимые различия наблюдаются только между обломками из Обцарского оврага и всеми остальными разрезами. Причем эти различия проявляются для всех морфометрических коэффициентов (рис. 1). Морфометрические показатели обломков из остальных разрезов между собой статистически значимо не различаются (рис. 1).  

```{r boxplots, dependson="import"}
ggvis_boxplot <- function(var_name, axis_name, domain_min, domain_max, item){
  rocks %>% 
    ggvis(~Place, prop("y", as.name(var_name))) %>%
    layer_boxplots() %>%
    add_axis("x", orient = "top", ticks = 0, title = item,
             properties = axis_props(axis = list(stroke = "white"), 
                                     labels = list(fontSize = 0))) %>%
    add_axis("x", title = "Разрез", title_offset = 35) %>%
    scale_numeric("y", domain = c(domain_min, domain_max), 
                  clamp = T, label = axis_name) %>%
    set_options(width = 900, height = 400)
}

ggvis_boxplot("KI", "Коэффициент изометричности", 0, 20, "a)")
ggvis_boxplot("KL", "Коэффициент удлиненности", -1, 1, "b)")
ggvis_boxplot("KH", "Коэффициент уплощенности", -1, 1, "c)")
```

**Рис. 1. Графики боксплот для коэффициентов изометричности (a), удлиненности (b) и уплощенности (c)**


### ***2.3. T-критерий Стьюдента***

Сравнение двух выделенных ранее групп отложений - аллювиальных и пролювиальных, производилось при помощи t-критерия Стьюдента. По его результатам нельзя отклонить нулевую гипотезу о равенстве математических ожиданий в этих двух группах, так как уровень значимости для всех морфометрических коэффициентов больше 0.05. Следовательно, морфометрические показатели для обломков из аллювиальных и пролювиальных отложений статистически значимо не различаются.  

```{r t-tests, dependson="import"}
alluvium <- c("Излучина реки Протвы", "Пойма реки Протвы", "Рыжковское кладбище", "Ручей Язвицы")
proluvium <- c("Волчий овраг", "Егоров овраг", "Обцарский овраг")

t_KI_t <- t.test(rocks$KI[rocks$Place == alluvium], rocks$KI[rocks$Place == proluvium])$stat
t_KL_t <- t.test(rocks$KL[rocks$Place == alluvium], rocks$KL[rocks$Place == proluvium])$stat
t_KH_t <- t.test(rocks$KH[rocks$Place == alluvium], rocks$KH[rocks$Place == proluvium])$stat

t_KI_p <- t.test(rocks$KI[rocks$Place == alluvium], rocks$KI[rocks$Place == proluvium])$p.val
t_KL_p <- t.test(rocks$KL[rocks$Place == alluvium], rocks$KL[rocks$Place == proluvium])$p.val
t_KH_p <- t.test(rocks$KH[rocks$Place == alluvium], rocks$KH[rocks$Place == proluvium])$p.val

t_table <- data.table(c("Коэффициент изометричности", "Коэффициент удлиненности", "Коэффициент уплощенности"), c(t_KI_t, t_KL_t, t_KH_t), c(t_KI_p, t_KL_p, t_KH_p))
colnames(t_table) <- c("Морфометрический коэффициент", "t-значение", "Уровень значимости")

kable(t_table, align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "condensed", "bordered"), 
                full_width = F, position = "center") %>%
  add_header_above(c("Таблица 4. Результаты сравнения аллювиальных и пролювиальных отложений при помощи t-критерия Стьюдента" = ncol(t_table)))
```


## **3. РЕЗУЛЬТАТЫ**
В ходе исследования были получены следующие результаты:

1. Существует статистически значимая взаимосвязь отложений из исследуемых разрезов с морфометрическими показателями формы обломков. Однако, эта связь проявляется только между отложениями из Обцарского оврага и всеми остальными отложениями

2. Для аллювиальных и пролювиальных отложений статистически значимых различий в морфометрических показателях обломков выявлено не было.

## **БИБЛИОГРАФИЯ**
[1] Спиридонов А. И. Основы общей методики полевых геоморфологических исследований. Часть 3, выпуск 1 - Изд-во МГУ, 1963  

[2]	Симонов Ю. Г. Морфометрический анализ рельефа — Изд-во Смоленского гос. ун-та Смоленск, 1998.